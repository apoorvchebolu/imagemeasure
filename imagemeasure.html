<html>
<head>
	<script type="text/javascript" src="js/jquery-2.0.2.min.js"></script>
	<script type="text/javascript">
		$(document).ready(function(){

			var canvas, ctx, flag = false,
			    prevX = 0,
			    currX = 0,
			    prevY = 0,
			    currY = 0,
			    dot_flag = false;

			var x = "black",
			    y = 2;

			// init();

			$(function() {
				// alert("init");
			    canvas = $('#can');
			    ctx = canvas[0].getContext("2d");
			    w = canvas[0].width;
			    h = canvas[0].height;

			    // alert("width: " + w);


			    canvas.mousedown(function(e){
			    	// alert("down");

			    	findxy('down', e);
			    	
			    });

			    canvas.mousemove(function(e){
			    	// alert("move");
			    	findxy('move', e);
			    });

			    canvas.mouseup(function(e){
			    	// alert("up");
			    	findxy('up', e);
			    });

			    canvas.mouseout(function(e){
			    	// alert("out");
			    	findxy('out', e);
			    });

			    $('#clr').click(function(e){
			    	erase();
			    });
			    $('#sav').click(function(e){
					save();
			    });
			});

			function draw() {
				// alert("Draw");
			    ctx.beginPath();
			    // alert("Draw works");
			    ctx.moveTo(prevX, prevY);
			    ctx.lineTo(currX, currY);
			    ctx.strokeStyle = x;
			    ctx.lineWidth = y;
			    ctx.stroke();
			    ctx.closePath();
			}

			function erase() {
			    var m = confirm("Want to clear");
			    if (m) {
			        ctx.clearRect(0, 0, w, h);
			        // $("#canvasimg")[0].style.display = "none";
			        $("#canvasimg").hide();
			    }
			}

			function save() {
			    var dataURL = canvas[0].toDataURL();
			    $("#canvasimg").css({
			    	"border-width": "2px",
			    	"border-style": "solid"
				});
				$("#canvasimg").attr("src", dataURL);
			    $("#canvasimg").show();
			}

			function findxy(res, e) {
				// alert("findxy");
			    if (res == 'down') {
			    	currX = e.clientX - canvas.offset().left;
		            currY = e.clientY - canvas.offset().top;
			        prevX = currX;
			        prevY = currY;
			        
			        // alert("currx: "+currX);

			        flag = true;
			        dot_flag = true;
			        if (dot_flag) {
			            ctx.beginPath();
			            ctx.fillStyle = x;
			            ctx.fillRect(currX, currY, 2, 2);
			            ctx.closePath();
			            dot_flag = false;
			        }
			    }

			    if (res == 'up') {
			    	// alert("up");
			        flag = false;
			        currX = e.clientX - canvas.offset().left;
			        currY = e.clientY - canvas.offset().top;
			        draw();
			        // alert("up");
			    }
			    if (res == 'move') {
		        	// alert("moving");
		        	
		            // prevX = currX;
		            // prevY = currY;
		            
		            // draw();
		        
			    }
			}
		});
	</script>
</head>

<body>
	<canvas id="can" width="400" height="400" style="position:absolute;top:10%;left:10%;border:2px solid;"></canvas>
    <img id="canvasimg" style="position:absolute;top:10%;left:52%;" style="display:none;">
    <input type="button" value="save" id="sav" size="30" onclick="save()" style="position:absolute;top:55%;left:10%;">
    <input type="button" value="clear" id="clr" size="23" onclick="erase()" style="position:absolute;top:55%;left:15%;">
</body>

</html>